//  TESTIMONIAL DATA
const testimonials = [
  {
    company: "City Manager, Meraki Spa & Blends",
    quote:
      "I discovered Telecrm to be notably superior in efficiency. It grants me unparalleled insight into the performance of each sales representative.",
    name: "Bhupendra Adhikari",
    role: "",
    profileImage: "images/Bhupendra Adhikari.png",
    rating: "⭐️⭐️⭐️⭐️⭐️",
  },
  {
    company: " Paper Planes",
    quote:
      "With Telecrm, after-sales service has been top-notch. The response has been quite good, and I always receive timely service.",
    name: "Dr. Prashant Belchandan",
    role: "Product Manager at TechCorp",
    profileImage: "images/Dr. Prashant Belchandan.png",
    rating: "⭐️⭐️⭐️⭐️⭐️",
  },
  {
    company: "Owner, Ideal Dealers Private Limited",
    quote:
      " One of the biggest improvements has been field team tracking. We can now instantly see how many client visits happened each day and which team member visited whom.",
    name: "Keshav",
    role: "Owner",
    profileImage: "images/Keshav.png",
    rating: "⭐️⭐️⭐️⭐️",
  },
  {
    company: "Villazio Hospitality",
    quote:
      "  Brilliant software! Well made. The support and training is mind-blowing. Never seen such care and concern by an after-sales team.",
    name: "Akhtar Khan",
    role: "Founder",
    profileImage: "images/Akhtar Khan.png",
    rating: "⭐️⭐️⭐️⭐️⭐️",
  },
  {
    company: " Singh Apple Orchids",
    quote:
      "No need to check on the callers. Calling is quicker and easier than ever! Manager ka kaam kaafi simple ho gaya.",
    name: "Raaj Perhaate",
    role: "",
    profileImage: "images/Raaj Perhaate.png",
    rating: "⭐️⭐️⭐️",
  },
  {
    company: "Yamaha Motor Solutions India Pvt. Ltd.",
    quote:
      "It’s a fantastic CRM that I’ve explored so far! The self-customisation features are unique. Also, their support team is awesome.",
    name: "Vir Bharat",
    role: " Head HR Business Partner",
    profileImage: "images/Vir Bharat.png",
    rating: "⭐️⭐️⭐️⭐️",
  },
  {
    company: "India Studies",
    quote:
      "Aap log bohot acha kar rahe ho, amazing job. Your software is amazing, no doubt. Hardly kabhi problem aati hai. Things are good…..",
    name: "Ananya Hemani",
    role: " Co-founder,",
    profileImage: "images/Ananya Hemani.png",
    rating: "⭐️⭐️⭐️⭐️⭐️",
  },
  {
    company: "Brikitt Proptech Pvt. Ltd.",
    quote:
      "Telecrm has truly transformed the way we manage our sales. It's streamlined our entire process, making follow-ups, lead tracking, and communication far more efficient.",
    name: "Mohammad Salman",
    role: " Head – CRM, ",
    profileImage: "images/Mohammad Salman.png",
    rating: "⭐️⭐️⭐️⭐️⭐️",
  },
  {
    company: "Osaka Group",
    quote:
      "I was able to train my entire team within a short span of time because of its simplicity. Telecrm has helped us bring structure to our lead management process across verticals.",
    name: "Saranya",
    role: " Customer Relations Manager",
    profileImage: "images/Saranya.png",
    rating: "⭐️⭐️⭐️⭐️⭐️",
  },
];

const journeyData = [
  {
    title: "The problem",
    description:
      "We were selling our own software using various CRMs, but they were either too complex, too expensive, or simply didn’t fit our needs — since none were built around calling and WhatsApp.",
  },
  {
    title: "The birth of Telecrm",
    description:
      "And thus, we built a CRM to solve our own problems which eventually evolved into Telecrm — a CRM specific to the Indian market, affordable, simple, and easy to use.",
  },
  {
    title: "From garage to growth",
    description:
      "What started from a garage at Aligarh with a small team of 5 people has now grown into a company that serves over 2500+ enterprises.",
  },

  {
    title: "Our first customer",
    description:
      "Our first customer wasn't just a client — they were the proof that we were on the right path. They’ve grown with us over the years, and their success reminds us every day of why we started.",
  },
  {
    title: "Stay tuned",
    description: "There's so much more to come!",
    image: "https://telecrm.in/assets/images/about-us/Group%201000006976.png",
  },
];

const faqData = [
  {
    question:
      "How has telecrm helped 2,500+ companies manage and grow their sales operations?",
    answer: `
     <p> telecrm’s powering more than 2500 businesses by capturing leads from everywhere, keeping tabs on every follow-up and helping them close way more deals quickly and efficiently — all from a single, easy-to-use platform. 
Whether you're an early-stage startup or an established enterprise, it automates lead handoffs, lets you listen in on calls, tracks WhatsApp chats and gives real-time insights that keep everyone accountable and make the job easy to do.
     </p>
 <p> 
 Whether you're an early-stage startup or an established enterprise, it automates lead handoffs, lets you listen in on calls, tracks WhatsApp chats and gives real-time insights that keep everyone accountable and make the job easy to do.
  </p>
    `,
  },
  {
    question: "What makes telecrm different from other CRM software in India?",
    answer: `<p>
    No hassle with add-ons here! Get easy integrations for calling or WhatsApp telecrm — has both built in. It’s lightweight, you can tweak it however you want and you need zero tech expertise to get started. 
    </p>
    <p>
We have no hidden costs —  we are not going to charge you every step of the way. Features that you see, you get it all in the package itself and from auto-dialers to WhatsApp automations. It’s made to solve real sales headaches and telecalling problems. 
    </p>
    `,
  },
  {
    question:
      " Can telecrm automate lead capture, distribution, and follow-up reminders?",
    answer: `<p>
    Yes. telecrm connects with your lead sources (Google Ads, Facebook, website forms, marketplaces, etc.), captures leads instantly. Then auto-assigns them to the right agent, and fires off reminders via WhatsApp, email or in-app alerts. No enquiry sits idle, ensuring quick action.
    </p>`,
  },
  {
    question:
      "Does telecrm have a mobile app for tracking sales and leads on the go?",
    answer: `<p>Totally! The app’s a lifesaver for field reps as they can view leads, update statuses, make calls, shoot WhatsApp messages and check performance from anywhere.
Perfect for field and remote teams who need quick access without sitting in front of a desktop.
</p>
<p>
Perfect for field and remote teams who need quick access without sitting in front of a desktop.sss
</p>
`,
  },

  {
    question:
      "What kind of reports and analytics does telecrm provide for performance tracking?",
    answer: `
<p>
You get real-time dashboards that show everything: <strong>lead progress, call stats, how many follow-ups got done, conversion rates and team productivity</strong>.
</p>
<p>
Managers can filter by user, source, date or any combination you can think of to spot what’s working (and fix what’s not). 
</p>
<p>
Custom reports can also be created to track KPIs specific to your business. 
</p>
`,
  },
  {
    question:
      "How secure and reliable is customer data on telecrm’s cloud system?",
    answer: `
<p>
Top-notch! Data security is a top priority. TeleCRM <strong>uses encrypted cloud storage with access-based permissions</strong>, so your customer data is always safe.
</p>
<p>
Regular backups, SSL-protected servers, role-based access, and strict admin controls ensure that only the right people can see or handle sensitive information.
</p>
`,
  },
];

//  ICONS & TOOLTIPS

const icons = {
  google: "https://telecrm.in/assets/images/testimonial/google-icon.svg",
  video:
    "data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='red' viewBox='0 0 24 24'%3e%3cpath d='M8 5v14l11-7z'/%3e%3c/svg%3e",
};

const tooltips = {
  google: "View on Google",
  video: "Play Video",
};

// CASE STUDY

// let currentSlide = 0;
// const journeyContainer = document.getElementById("journeyContainer");
// const dotsContainer = document.getElementById("dots");
// const totalSlides = journeyData.length;
// const animationTimers = new WeakMap();

// function getCardsPerView() {
//   return window.innerWidth <= 600 ? 1 : 3;
// }

// function renderDots() {
//   dotsContainer.innerHTML = "";
//   for (let i = 0; i < totalSlides; i++) {
//     const dot = document.createElement("div");
//     dot.classList.add("dot");
//     if (i === 0) dot.classList.add("active");
//     dot.addEventListener("click", () => updateSlide(i));
//     dotsContainer.appendChild(dot);
//   }
// }

// function updateDots() {
//   document.querySelectorAll(".dot").forEach((dot, i) => {
//     dot.classList.toggle("active", i === currentSlide);
//   });
// }

// function getVisibleCards(startIndex) {
//   const visibleData = [];
//   const cardsPerView = getCardsPerView();
//   for (let i = 0; i < cardsPerView; i++) {
//     visibleData.push(journeyData[(startIndex + i) % totalSlides]);
//   }
//   return visibleData;
// }

// function createCardContent(data) {
//   return `
//     <div class="journey-card-title">${data.title}</div>
//     <div class="journey-card-description">${data.description}</div>
//     ${
//       data.image
//         ? `<div class="journey-card-image"><img src="${data.image}" alt="${data.title}"></div>`
//         : ""
//     }
//   `;
// }

// function initializeJourneyCards() {
//   journeyContainer.innerHTML = "";
//   const cardsPerView = getCardsPerView();

//   for (let i = 0; i < cardsPerView; i++) {
//     const card = document.createElement("div");
//     card.className = "journey-card";

//     // Create two content layers for animation
//     const layer1 = document.createElement("div");
//     layer1.className = "journey-content active";

//     const layer2 = document.createElement("div");
//     layer2.className = "journey-content";

//     card.appendChild(layer1);
//     card.appendChild(layer2);
//     journeyContainer.appendChild(card);
//   }
// }

// function updateSlide(index, direction = "next") {
//   const cardsPerView = getCardsPerView();
//   currentSlide = ((index % totalSlides) + totalSlides) % totalSlides;
//   updateDots();

//   const visibleData = getVisibleCards(currentSlide);
//   const cards = journeyContainer.querySelectorAll(".journey-card");

//   // Ensure cards exist before trying to update them
//   if (cards.length === 0) {
//     initializeJourneyCards();
//     return updateSlide(index, direction);
//   }

//   cards.forEach((card, i) => {
//     const layers = [...card.querySelectorAll(".journey-content")];
//     const activeLayer = layers.find((l) => l.classList.contains("active"));
//     const nextLayer = layers.find((l) => !l.classList.contains("active"));

//     // Cancel any previous cleanup timer
//     if (animationTimers.has(card)) clearTimeout(animationTimers.get(card));

//     // Fill next layer immediately
//     if (visibleData[i]) {
//       nextLayer.innerHTML = createCardContent(visibleData[i]);
//     }

//     // Reset classes
//     layers.forEach((l) =>
//       l.classList.remove(
//         "enter-from-left",
//         "enter-from-right",
//         "exit-left",
//         "exit-right"
//       )
//     );

//     // Animate layers
//     if (direction === "next") {
//       activeLayer.classList.add("exit-left");
//       nextLayer.classList.add("enter-from-right");
//     } else {
//       activeLayer.classList.add("exit-right");
//       nextLayer.classList.add("enter-from-left");
//     }

//     // Swap active layer immediately
//     activeLayer.classList.remove("active");
//     nextLayer.classList.add("active");

//     // Schedule cleanup of old layer safely
//     const timer = setTimeout(() => {
//       activeLayer.innerHTML = "";
//       activeLayer.classList.remove("exit-left", "exit-right");
//     }, 600);
//     animationTimers.set(card, timer);
//   });
// }

// // Arrow controls
// document
//   .getElementById("nextBtn")
//   ?.addEventListener("click", () => updateSlide(currentSlide + 1, "next"));
// document
//   .getElementById("prevBtn")
//   ?.addEventListener("click", () => updateSlide(currentSlide - 1, "prev"));

// // Swipe for mobile
// let startX = 0;
// journeyContainer.addEventListener(
//   "touchstart",
//   (e) => (startX = e.touches[0].clientX)
// );
// journeyContainer.addEventListener("touchend", (e) => {
//   const diffX = e.changedTouches[0].clientX - startX;
//   if (diffX > 50) updateSlide(currentSlide - 1, "prev");
//   if (diffX < -50) updateSlide(currentSlide + 1, "next");
// });

// // Resize handling
// window.addEventListener("resize", () => {
//   initializeJourneyCards();
//   updateSlide(currentSlide, "next");
// });

// // Initialize journey section
// function initializeJourneySection() {
//   renderDots();
//   initializeJourneyCards();
//   updateSlide(0, "next");
// }

// // Call this when the DOM is fully loaded
// document.addEventListener("DOMContentLoaded", function () {
//   initializeJourneySection();
// });

// // Also call it immediately in case DOM is already loaded
// if (document.readyState === "loading") {
//   document.addEventListener("DOMContentLoaded", initializeJourneySection);
// } else {
//   initializeJourneySection();
// }

// FAQ
const faqContainer = document.getElementById("faqContainer");

// Dynamically generate FAQ items
faqData.forEach((faq) => {
  const faqItem = document.createElement("div");
  faqItem.classList.add("faq-item");

  faqItem.innerHTML = `
    <button class="faq-question">
      <span>${faq.question}</span>
      <span class="faq-arrow"></span>
    </button>
    <div class="faq-answer">${faq.answer}</div>
  `;

  faqContainer.appendChild(faqItem);
});

// Add toggle functionality
faqContainer.addEventListener("click", (e) => {
  if (
    e.target.classList.contains("faq-question") ||
    e.target.closest(".faq-question")
  ) {
    const item = e.target.closest(".faq-item");
    item.classList.toggle("active");
  }
});

//  CREATE TESTIMONIAL CARD
function createTestimonialCard(testimonial) {
  const card = document.createElement("div");
  card.className = "testimonial-card";

  let screenshotHTML = testimonial.screenshotImage
    ? `
      <div class="testimonial-screenshot">
        <img src="${testimonial.screenshotImage}" alt="Screenshot from ${testimonial.name}">
      </div>
    `
    : "";

  let quoteHTML = "";
  if (testimonial.quote) {
    const maxChars = 100;
    const needsTruncation = testimonial.quote.length > maxChars;

    let displayQuote = testimonial.quote;
    if (needsTruncation) {
      // Truncate at word boundary
      const truncated = testimonial.quote.substring(0, maxChars);
      const lastSpace = truncated.lastIndexOf(" ");
      displayQuote =
        (lastSpace > 0 ? truncated.substring(0, lastSpace) : truncated) + "...";
    }

    quoteHTML = `
      <div class="testimonial-quote-container">
        <p class="testimonial-quote">${displayQuote}${
      needsTruncation
        ? `<span class="read-more"
            data-company="${testimonial.company.replace(/"/g, "&quot;")}"
            data-name="${testimonial.name.replace(/"/g, "&quot;")}"
            data-role="${testimonial.role.replace(/"/g, "&quot;")}"
            data-quote="${testimonial.quote.replace(/"/g, "&quot;")}"
            data-profile="${testimonial.profileImage}"
            data-link="${testimonial.link || ""}"
            data-type="${testimonial.linkType || ""}"
            data-rating="${testimonial.rating || ""}"
          > Read More</span>`
        : ""
    }
        </p>
      </div>
    `;
  }

  let linkHTML = testimonial.link
    ? `
      <button class="testimonial-link-button" data-link="${
        testimonial.link
      }" data-type="${testimonial.linkType}">
        <img src="${icons[testimonial.linkType]}" alt="link">
        <span>${tooltips[testimonial.linkType]}</span>
      </button>
    `
    : "";

  card.innerHTML = `
    <h2 class="testimonial-company">${testimonial.company}</h2>
    ${quoteHTML}
    ${screenshotHTML}
    <div class="testimonial-footer">
      <div class="testimonial-author">
        <img src="${testimonial.profileImage}" alt="Profile picture of ${
    testimonial.name
  }" class="testimonial-profile-image">
        <div class="testimonial-author-info">
          <h3>${testimonial.name}</h3>
          <p>${testimonial.role}</p>
          ${
            testimonial.rating
              ? `<div class="testimonial-rating">${testimonial.rating}</div>`
              : ""
          }
        </div>
      </div>
      ${linkHTML}
    </div>
  `;

  return card;
}

function playVideo() {
  document.querySelector(".video-placeholder").style.display = "none";
  document.getElementById("youtube-player").style.display = "block";
}

// RENDER TESTIMONIALS
function renderTestimonials() {
  const grid = document.getElementById("testimonialGrid");
  testimonials.forEach((testimonial) => {
    const card = createTestimonialCard(testimonial);
    grid.appendChild(card);
  });

  // STATS BAR
  function animateNumber(element, duration = 2000) {
    const target = +element.getAttribute("data-target");
    const suffix = element.getAttribute("data-suffix") || "";
    let start = 0;
    const increment = target / (duration / 16);

    function update() {
      start += increment;
      if (start < target) {
        element.textContent = Math.floor(start).toLocaleString() + suffix;
        requestAnimationFrame(update);
      } else {
        element.textContent = target.toLocaleString() + suffix;
      }
    }

    update();
  }

  // Intersection Observer to trigger animation when section is visible
  const statsSection = document.querySelector(".stats-container");
  const statNumbers = document.querySelectorAll(".stat-number");
  let hasAnimated = false;

  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting && !hasAnimated) {
          hasAnimated = true;
          statNumbers.forEach((number) => {
            animateNumber(number);
          });
          observer.unobserve(entry.target);
        }
      });
    },
    { threshold: 0.5 }
  );

  if (statsSection) {
    observer.observe(statsSection);
  }

  // Animate all stat numbers on page load
  document.querySelectorAll(".stat-number").forEach((el) => {
    animateNumber(el);
  });
}

//  VIDEO MODAL LOGIC
const modal = document.getElementById("videoModal");
const closeModalBtn = document.getElementById("closeModal");
const videoIframe = document.getElementById("videoIframe");
const heroPlayBtn = document.getElementById("heroPlayBtn");

// Function to open modal and autoplay
function openVideoModal(embedLink) {
  // Add autoplay parameter
  const autoplayLink = embedLink + "?autoplay=1";
  videoIframe.src = autoplayLink;
  modal.classList.add("active");
  document.body.classList.add("modal-open");
}

// Function to close modal and stop video
function closeVideoModal() {
  modal.classList.remove("active");
  document.body.classList.remove("modal-open");
  videoIframe.src = "";
}

// Single click on hero play button
heroPlayBtn.addEventListener("click", () => {
  openVideoModal("https://www.youtube.com/embed/CCDRBTYSo6c");
});

// Modal close events
closeModalBtn.addEventListener("click", closeVideoModal);
modal.addEventListener("click", (e) => {
  if (
    e.target === modal ||
    e.target.classList.contains("video-modal-overlay")
  ) {
    closeVideoModal();
  }
});
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape" && modal.classList.contains("active")) {
    closeVideoModal();
  }
});

// READ MORE MODAL LOGIC
const testimonialModal = document.getElementById("testimonialModal");
const closeTestimonialModal = document.getElementById("closeTestimonialModal");
const modalCompany = document.getElementById("modalCompany");
const modalQuote = document.getElementById("modalQuote");
const modalAuthor = document.getElementById("modalAuthor");
const modalLinkContainer = document.getElementById("modalLinkContainer");

let scrollbarWidth = window.innerWidth - document.documentElement.clientWidth;

function openTestimonialModal(data) {
  modalCompany.textContent = data.company;
  modalQuote.textContent = data.quote;

  modalAuthor.innerHTML = `
    <div style="display:flex;align-items:center;gap:0.75rem;margin-top:1rem;">
      <img src="${data.profile}" 
           style="width:5rem;height:5rem;border-radius:9999px;object-fit:cover;">
      <div style="display:flex;flex-direction:column;justify-content:center;gap:0.3rem;line-height:1.3;">
        <h3 style="font-weight:600;font-size:1rem;margin:0;">${data.name}</h3>
        <p style="font-size:0.95rem;color:#6b7280;margin:0;">${data.role}</p>
        ${
          data.rating
            ? `<div class="testimonial-rating" style="font-size:1rem;line-height:1;margin:0;">${data.rating}</div>`
            : ""
        }
      </div>
    </div>
  `;

  if (data.link) {
    modalLinkContainer.innerHTML = `
      <button class="testimonial-link-button" data-link="${
        data.link
      }" data-type="${data.type}">
        <img src="${icons[data.type]}" alt="link">
        <span>${tooltips[data.type]}</span>
      </button>
    `;
  } else {
    modalLinkContainer.innerHTML = "";
  }

  testimonialModal.classList.add("active");
  document.body.style.overflow = "hidden";
  document.body.style.paddingRight = `${scrollbarWidth}px`;
}

function closeTestimonialPopup() {
  testimonialModal.classList.remove("active");
  document.body.style.overflow = "";
  document.body.style.paddingRight = "";
}

closeTestimonialModal.addEventListener("click", closeTestimonialPopup);
testimonialModal.addEventListener("click", (e) => {
  if (e.target === testimonialModal) closeTestimonialPopup();
});

//  EVENT HANDLERS
document.addEventListener("click", (e) => {
  // Handle Read More click
  const readMore = e.target.closest(".read-more");
  if (readMore) {
    const data = {
      company: readMore.dataset.company,
      quote: readMore.dataset.quote,
      name: readMore.dataset.name,
      role: readMore.dataset.role,
      profile: readMore.dataset.profile,
      link: readMore.dataset.link,
      type: readMore.dataset.type,
      rating: readMore.dataset.rating,
    };
    openTestimonialModal(data);
    return;
  }

  // Handle video/google link buttons
  const button = e.target.closest(".testimonial-link-button");
  if (button) {
    const link = button.dataset.link;
    const type = button.dataset.type;

    if (type === "video") {
      openVideoModal(link);
    } else {
      window.open(link, "_blank");
    }
  }
});

//  INITIALIZE
renderTestimonials();
